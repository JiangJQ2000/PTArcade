The configuration file is a python file that allows to adjust several 
parameters of the run. The parameters that can be set in the configuration
file are:

[`pta_data`](#+config.pta_data){ #+config.pta_data }

:   :octicons-milestone-24: Default: `'NG15'`– 
    This variable needs to be assigned to a string specifying the PTA data
    set that will be used in the analysis. The datasets currently implemented
    in PTArcade are NANOGrav 15-year (`pta_data = "NG15"`), NANOGrav 12.5-year
    (`pta_data = "NG12"`), and IPTA DR2 (`pta_data = "IPTA2"`).


[`N_samples`](#+config.N_samples){ #+config.N_samples }

:   :octicons-milestone-24: Default: `int(2e6)` – 
    This variable can be assigned to an integer specifying the number
    of points that will be generated by the Monte Carlo sampler.

    !!! note "Thinning"
        In order to reduce the autocorrelation lengh, the MC chain are automatically
        thinned by a factor of 10. Therefore, the number of MC samples that will be 
        saved is given by `N_samples`/10.

[`mode`](#+config.mode){ #+config.mode }

:   :octicons-milestone-24: Default: `enterprise` – 
    PTArcade can be run in two modes: 
    
    * `mode = enterprise`: in this configuration, the code will analyze the full PTA
    dataset in the time domain by using the numerical techniques implemented in 
    [ENTERPRISE].

    * `mode = ceffyl`: in this configuration, the code will analyze PTA data at the level
    of the *Bayesian peridiograms* (1), and fit the user-specified signal to these Bayesian
    periodograms using the numerical techniques implemented in [Ceffyl].
    { .annotate }

        1.  Probability density reconstructions of the pulsar timing-residual power spectral
        density at each frequency (commonly referred to as the "violins plot").
        See [here][GFL] for more details.

    !!! warning "Ceffyl and deterministic signals"
        The Ceffyl mode can only be used to analyze stochastic signals. If your 
        signal is deterministic you have to run in ENTERPRISE mode. 

    ??? note "Please, add relevant citations"
        Please, if you use PTArcade in ENTERPRISE mode, add the following 
        citations

        ```
        @misc{enterprise,
            author       = {Justin A. Ellis and Michele Vallisneri and Stephen R. Taylor and Paul T. Baker},
            title        = {ENTERPRISE: Enhanced Numerical Toolbox Enabling a Robust PulsaR Inference SuitE},
            month        = sep,
            year         = 2020,
            howpublished = {Zenodo},
            doi          = {10.5281/zenodo.4059815},
            url          = {https://doi.org/10.5281/zenodo.4059815}
            }

        @misc{enterprise-ext,
            author       = {Stephen R. Taylor and Paul T. Baker and Jeffrey S. Hazboun and Joseph Simon and Sarah J. Vigeland},
            title        = {enterprise_extensions},
            year         = {2021},
            url          = {https://github.com/nanograv/enterprise_extensions},
            note         = {v2.3.3}
            }
        ```

        If you use PTArcade in Ceffy mode, please cite 

        ```
        @misc{lamb2023need,
            title={The Need For Speed: Rapid Refitting Techniques for Bayesian Spectral Characterization of the Gravitational Wave Background Using PTAs}, 
            author={William G. Lamb and Stephen R. Taylor and Rutger van Haasteren},
            year={2023},
            eprint={2303.15442},
            archivePrefix={arXiv},
            primaryClass={astro-ph.HE}
            }
        ```
        

[`out_dir`](#+config.out_dir){ #+config.out_dir }

:   :octicons-milestone-24: Default: `'./chains/'` –
    This variable can be assigned to a string to specify the output directory.

[`resume`](#+config.resume){ #+config.resume }

:   :octicons-milestone-24: Default: `False` –
    If `resume = True`, the code will look for MCMC chains in the output directory
    and if it finds some it will restart sampling from those instead of starting
    from scratch. If no `resume = True` and no chains are found in the output 
    directory, the sampler will start from scratch.

    !!! warning 

        If `resume = False` (which is the default value) any chain that is present in the output 
        directory at the start of your run will be overwritten. 

[`mod_sel`](#+config.mod_sel){ #+config.mod_sel }

:   :octicons-milestone-24: Default: `False` –
    PTArcade can also be used to compare new-physics interpretations of PTAs signals 
    against the astrophysical interpretation in terms of SMBHB. If `mod_sel = True`, 
    a model indexing variable (controlling which model likelihood is active at each MCMC iteration)
    will sampled along with the parameters of the competing models. This will then allow
    to derive the [Bayes factor][bf] between models by simpling taking the ratio of
    samples spent in each bin of the model indexing variable.

    !!! tip "Get the BF"
        After running with `mod_sel = True` you can easily derive the Bayes factor 
        using the function [`get_bf`][ptarcade.chains_utils.compute_bf] defined in the 
        PTArcade [`chains_utils`][chains_utils] module.

[`corr`](#+config.corr){ #+config.corr }

:   :octicons-milestone-24: Default: `False` –
    If set to `False`, 

    !!! warning "Running time"
        When `mod = enterprise`, running with `corr = True` is appriximately one order
        or magnitude slower than running with `corr = False`. If you want to run with 
        `corr = True` we suggest to either use `mode = ceffyl` or run on a cluster.
    

[`red_components`](#+config.red_components){ #+config.red_components }

:   :octicons-milestone-24: Default: `30` –
    This variable can be assigned to an integer specyfing the number of frequency
    components that will be used to model intrinisc red noise. (1)

[`gwb_components`](#+config.gwb_components){ #+config.gwb_components }

:   :octicons-milestone-24: Default: `14` –
    This variable can be assigned to an integer specyfing the number of frequency
    components that will be used to model intrinisc red noise. (1)

    !!! tip "Suggested number of GWB components"
        === "IPTA2"
            We suggest using `gwb_components = 13`. 
        
        === "NG12"
            We sugget using `gwb_components = 5`.

        === "NG15"
            We sugget using `gwb_components = 14`.

As we already mentioned, the GWB signal specified by the user can be superimposed
with the signal from SMBHB or compared to it. The GWB signal from SMBHB is modeled as 
a powerlaw:

$$
h^2\Omega_{\textrm{GW}}(f) = \frac{2 \pi^2}{3 H_0^2} \left(\frac{f}{\textrm{year}}\right)^{5-\gamma}\textrm{year}^2
$$

The prior distributions for $A_{\textrm BHB}$ and $\gamma_{\textrm BHB}$ can be controlled
with the following parameters in the configuration file:

[`bhb_th_prior`](#+config.bhb_th_prior){ #+config.bhb_th_prior }

:   :octicons-milestone-24: Default: `True` –
    If `bhb_th_prior = True` the prior for the SMBHB signal parameters will be chosen to 
    reflect predictions from astrophysical models (this is only relevant if you
    have selected `smbhb = True` in the [model file][model] or 
    [`mod_sel = True`](#+config.mod_sel)
    in the configuration file). (1)
    { .annotate }

    1.  For more info on the astrophysical models used to derived these priors see 
        [here][NG15newphys] and [here][NG15astro]

[`A_bhb_logmin`](#+config.A_bhb_logmin){ #+config.A_bhb_logmin }

:   :octicons-milestone-24: Default: `-18` –
    Can be assigned to a floating point or integer number to set the lower bound of the log-uniform prior for
    SMBHB signal amplitude (this is only relevant if [`bhb_th_prior = False`](#+config.bhb_th_prior)
    and you have selected `smbhb = True` in the [model file][model] or [`mod_sel = True`](#+config.mod_sel)
    in the configuration file).
    

[`A_bhb_logmax`](#+config.A_bhb_logmax){ #+config.A_bhb_logmax }

:   :octicons-milestone-24: Default: `-14` –
    Can be assigned to a floating point or integer number to set the upper bound of the log-uniform prior for
    SMBHB signal amplitude (this is only relevant if [`bhb_th_prior = False`](#+config.bhb_th_prior)
    and you have selected `smbhb = True` in the [model file][model] or [`mod_sel = True`](#+config.mod_sel)
    in the configuration file).

[`gamma_bhb`](#+config.gamma_bhb){ #+config.gamma_bhb }

:   :octicons-milestone-24: Default: `None` –
    Can be assigned to a floating point or integer number to set the value of $\gamma_{\textrm BHB}$.
    If `gamma_bhb = None`, a uniform prior between $0$ and $7$ will be used.

!!! example "Default configuration file"

    If no configuration file is specified by the user, the following configuration file will be 
    used

    ``` py
    pta_data = 'NG15'

    mode = 'ceffyl'

    mod_sel = False

    out_dir = './chains/'
    resume = False 
    N_samples = int(2e6) 

    # intrinsic red noises parameters
    red_components = 14 

    # bhbh signal parameters
    corr = False 
    gwb_components = 14 
    bhb_th_prior = True 
    ```


[model]: model.md
[bf]: https://en.wikipedia.org/wiki/Bayes_factor
[chains_utils]: ../utils/chain_utils.md
[NG15newphys]: https://en.wikipedia.org/wiki/Bayes_factor
[NG15astro]: https://en.wikipedia.org/wiki/Bayes_factor
[ENTERPRISE]: https://github.com/nanograv/enterprise
[GFL]: https://arxiv.org/pdf/2303.15442.pdf
[Ceffyl]: https://github.com/astrolamb/ceffyl
